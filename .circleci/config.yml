version: 2.1

orbs:
  orb-tools: circleci/orb-tools@11.6.1

workflows:
  verify:
    jobs:
      - orb-tools/pack:
          name: pack
          source-dir: src
      - orb-tools/publish:
          circleci-token: CIRCLE_API_USER_TOKEN
          name: publish-dev
          enable-pr-comment: false
          context: global
          filters:
            branches:
              ignore: master
          orb-name: entur/test-db
          pub-type: dev
          vcs-type: gh
          requires:
            - pack
      - orb-tools/publish:
          circleci-token: CIRCLE_API_USER_TOKEN
          name: publish-prod
          enable-pr-comment: false
          context: global
          filters:
            branches:
              only: master
          orb-name: entur/test-db
          pub-type: production
          vcs-type: gh
          requires:
            - pack
